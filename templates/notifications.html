{% extends "base.html" %}

{% block title %}Notifications - Easy Hotel{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Your Notifications</h3>
                    <span class="badge bg-light text-dark">{{ notifications|length }} notifications</span>
                </div>
                <div class="card-body">
                    {% if notifications %}
                        <div class="mb-3">
                            <input type="text" class="form-control" id="search-notifications" placeholder="Search notifications...">
                        </div>
                        
                        <div id="notifications-list">
                            {% for notification in notifications %}
                                <div class="notification-item {% if not notification.is_read %}unread{% endif %} search-item">
                                    <div class="d-flex justify-content-between">
                                        <h5>{{ notification.title }}</h5>
                                        <small class="notification-time">{{ notification.created_at.strftime('%b %d, %Y at %H:%M') }}</small>
                                    </div>
                                    <p class="mb-0">{{ notification.message }}</p>
                                    {% if not notification.is_read %}
                                        <span class="badge bg-primary">New</span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
                            <button id="mark-all-read" class="btn btn-outline-secondary">Mark All as Read</button>
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <p class="mb-0">You don't have any notifications at this time.</p>
                        </div>
                        <div class="d-grid">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Search notifications
    const searchInput = document.getElementById('search-notifications');
    if (searchInput) {
        searchInput.addEventListener('keyup', function() {
            const searchText = this.value.toLowerCase();
            document.querySelectorAll('.search-item').forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchText)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    }
    
    // Mark all as read button
    const markAllReadBtn = document.getElementById('mark-all-read');
    if (markAllReadBtn) {
        markAllReadBtn.addEventListener('click', function() {
            // In a real implementation, this would make an AJAX call to the server
            // For now, we'll just update the UI
            document.querySelectorAll('.notification-item.unread').forEach(item => {
                item.classList.remove('unread');
                item.querySelector('.badge')?.remove();
            });
            
            // Update notification badge in navbar
            const navBadge = document.getElementById('notification-badge');
            if (navBadge) {
                navBadge.style.display = 'none';
            }
            
            this.disabled = true;
            this.textContent = 'All notifications marked as read';
        });
    }
    
    // Reset notification badge in navbar
    const navBadge = document.getElementById('notification-badge');
    if (navBadge) {
        navBadge.style.display = 'none';
    }
});
</script>
{% endblock %}
